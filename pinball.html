<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>無限リフレクト・ピンボール — ビッグHUD＆バンパー増量 (Mobile Ready)</title>
<style>
html,body{
    height:100%;
    margin:0;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    background:#111;
    color:#eee;
    font-family:"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans JP",sans-serif;
    -webkit-user-select:none;
    user-select:none;
}
/* ======= HUD（画面最上部に固定・特大表示）======= */
#hud{
    position:fixed;
    top:0;
    left:0;
    width:100%;
    padding:.4rem 0;
    text-align:center;
    font-size:clamp(1.6rem,5vw,2.4rem); /* スマホで少し縮む */
    font-weight:bold;
    letter-spacing:.05em;
    background:#000a;
    pointer-events:none;
    z-index:10;
}

/* ======= ゲーム領域 ======= */
#container{
    margin-top:3.2rem; /* HUD分のスペース */
    display:flex;
    flex-direction:column;
    align-items:center;
    width:90vw;
    max-width:400px; /* PC では元の大きさ */
}
#gameCanvas{
    width:100%;          /* 画面幅にフィット */
    height:auto;         /* 縦横比維持して縮小 */
    background:#222;
    border:4px solid #555;
    border-radius:8px;
    box-shadow:0 0 16px rgba(0,0,0,.6);
    touch-action:none;   /* スクロール無効化 */
}

/* ======= モバイル専用リセットボタン ======= */
#resetBtn{
    margin-top:.6rem;
    padding:.4rem 1.2rem;
    font-size:1rem;
    font-weight:bold;
    color:#eee;
    background:#444;
    border:none;
    border-radius:6px;
    display:inline-flex;
    align-items:center;
    gap:.3rem;
}
#resetBtn:active{transform:scale(.96);}
@media (min-width:768px){ /* PC では非表示 */
    #resetBtn{display:none;}
}

p{margin:.5rem 0 0;font-size:.85rem;opacity:.8;}
</style>
</head>
<body>
<div id="hud">Score: <span id="score">0</span></div>
<div id="container">
    <canvas id="gameCanvas" tabindex="0" aria-label="ピンボールゲーム" width="400" height="600"></canvas>
    <button id="resetBtn" aria-label="ボールをリセット">🔄 リセット</button>
    <p>PC: R キー / Mobile: リセットボタン</p>
</div>
<script>
// =========================================================
//  Pinball – Big HUD & More Bumpers Edition (Mobile Ready)
// =========================================================
(()=>{
/* === 定数 === */
const canvas=document.getElementById("gameCanvas"),ctx=canvas.getContext("2d");
const W=400,H=600; // 内部ロジックは固定解像度のまま
const BAR_H=20;        // 床バー高さ
const REST=1;          // 完全反発
const BUMPER_REST=1.05;// バンパーは少し弾む

/* === HUD === */
let score=0;const scoreEl=document.getElementById("score");
const addScore=p=>{score+=p;}; // 描画時反映

/* === ボール === */
const SPEED=50; // すり抜けないギリギリ速度
const ball={
    x:W/2,
    y:H/2,
    r:8,
    vx:0,
    vy:0,
    trail:[],
    reset(){
        this.x=W/2;
        this.y=H/2;
        const angle=Math.random()*Math.PI*2;
        this.vx=Math.cos(angle)*SPEED;
        this.vy=Math.sin(angle)*SPEED;
        this.trail.length=0;
    }
};
ball.reset();

/* === バンパー増量 === */
const bumpers=[
  // 中央大
  {x:W/2 ,y:H*0.30 ,r:28,score:120},
  // 内周
  {x:W*0.25,y:H*0.45,r:22,score:60},
  {x:W*0.50,y:H*0.48,r:22,score:60},
  {x:W*0.75,y:H*0.45,r:22,score:60},
  // 外周
  {x:W*0.20,y:H*0.60,r:18,score:40},
  {x:W*0.40,y:H*0.65,r:18,score:40},
  {x:W*0.60,y:H*0.65,r:18,score:40},
  {x:W*0.80,y:H*0.60,r:18,score:40}
];
function collideBumper(b){
    const dx=ball.x-b.x,dy=ball.y-b.y;
    const dist=Math.hypot(dx,dy);
    const min=ball.r+b.r;
    if(dist<min){
        const nx=dx/dist,ny=dy/dist;
        ball.x=b.x+nx*min;
        ball.y=b.y+ny*min;
        const dot=ball.vx*nx+ball.vy*ny;
        ball.vx=(ball.vx-2*dot*nx)*BUMPER_REST;
        ball.vy=(ball.vy-2*dot*ny)*BUMPER_REST;
        normalizeSpeed();
        addScore(b.score);
    }
}

/* === 速度一定化 === */
function normalizeSpeed(){
    const mag=Math.hypot(ball.vx,ball.vy);
    ball.vx=ball.vx/mag*SPEED;
    ball.vy=ball.vy/mag*SPEED;
}

/* === 入力 === */
window.addEventListener("keydown",e=>{if(e.code==="KeyR")ball.reset();});
const resetBtn=document.getElementById("resetBtn");
resetBtn.addEventListener("click",()=>ball.reset());

/* === ループ === */
function physics(){
    ball.x+=ball.vx;ball.y+=ball.vy;
    if(ball.x-ball.r<0){ball.x=ball.r;ball.vx=-ball.vx*REST;}
    if(ball.x+ball.r>W){ball.x=W-ball.r;ball.vx=-ball.vx*REST;}
    if(ball.y-ball.r<0){ball.y=ball.r;ball.vy=-ball.vy*REST;}
    if(ball.y+ball.r>H-BAR_H){ball.y=H-BAR_H-ball.r;ball.vy=-ball.vy*REST;}

    bumpers.forEach(collideBumper);
    normalizeSpeed();

    ball.trail.push({x:ball.x,y:ball.y});if(ball.trail.length>25)ball.trail.shift();
}

function render(){
    ctx.clearRect(0,0,W,H);
    const g=ctx.createLinearGradient(0,0,0,H);g.addColorStop(0,"#222");g.addColorStop(1,"#111");ctx.fillStyle=g;ctx.fillRect(0,0,W,H);
    ctx.fillStyle="#444";ctx.fillRect(0,H-BAR_H,W,BAR_H);
    ctx.fillStyle="#666";bumpers.forEach(b=>{ctx.beginPath();ctx.arc(b.x,b.y,b.r,0,Math.PI*2);ctx.fill();});
    ball.trail.forEach((t,i)=>{const a=i/ball.trail.length;ctx.fillStyle=`rgba(255,218,98,${a*0.6})`;ctx.beginPath();ctx.arc(t.x,t.y,ball.r*(0.5+a*0.6),0,Math.PI*2);ctx.fill();});
    ctx.fillStyle="#ffda62";ctx.beginPath();ctx.arc(ball.x,ball.y,ball.r,0,Math.PI*2);ctx.fill();
    // HUD 更新
    scoreEl.textContent=score;
}

function loop(){physics();render();requestAnimationFrame(loop);}canvas.focus();loop();})();
</script>
</body>
</html>
